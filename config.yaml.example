# GitHub to Qdrant Sync Configuration Template
# Copy this file to config.yaml and update with your settings
# Sensitive data should be stored in environment variables (see .env.example)

# ============================================================
# GitHub Repository Configuration
# ============================================================
github:
  repository_url: https://github.com/your-org/your-repo.git
  branch: main
  clone_depth: 1
  cleanup_after_processing: true
  token: ${GITHUB_TOKEN}  # Optional: for private repos

# ============================================================
# Embedding Provider Selection
# ============================================================
# Choose one: azure_openai, mistral_ai, sentence_transformers
embedding_provider: mistral_ai

# ============================================================
# Azure OpenAI Configuration
# ============================================================
azure_openai:
  api_key: ${AZURE_OPENAI_API_KEY}
  endpoint: ${AZURE_OPENAI_ENDPOINT}
  deployment_name: text-embedding-3-large  # or text-embedding-ada-002
  api_version: "2024-02-01"

# ============================================================
# Mistral AI Configuration
# ============================================================
mistral_ai:
  api_key: ${MISTRAL_API_KEY}
  model: codestral-embed  # or mistral-embed
  output_dimension: 1536  # 1536 for codestral, 1024 for mistral-embed
  api_base: https://api.mistral.ai/v1

# ============================================================
# Sentence Transformers (Local) Configuration
# ============================================================
sentence_transformers:
  # Model options:
  # - sentence-transformers/all-MiniLM-L6-v2 (384 dimensions)
  # - intfloat/multilingual-e5-large (1024 dimensions)
  model: intfloat/multilingual-e5-large
  vector_size: 1024

# ============================================================
# Qdrant Vector Database Configuration
# ============================================================
qdrant:
  url: ${QDRANT_URL}  # https://your-cluster.cloud.qdrant.io or http://localhost:6333
  api_key: ${QDRANT_API_KEY}
  collection_name: your-collection-name
  vector_size: 1536  # Must match embedding dimensions
  distance: Cosine  # Options: Cosine, Euclidean, Dot
  vector_name: null  # null for unnamed vectors, "model-name" for named vectors
  recreate_collection: false  # WARNING: true will delete existing collection!
  
  # Connection method (auto-detected if not specified)
  # Options: auto, reverse_proxy, direct, url
  connection_method: auto
  timeout: 30

# ============================================================
# Document Processing Configuration
# ============================================================
processing:
  # File processing mode
  file_mode: all_text  # Options: all_text, markdown_only

  # Text chunking configuration
  chunk_size: 1000  # Characters per chunk (500-2000 recommended)
  chunk_overlap: 200  # Overlap for context continuity
  chunking_strategy: recursive  # Options: recursive (default), semantic
  
  # Markdown-specific extensions
  markdown_extensions:
    - .md
    - .markdown
    - .mdown
    - .mkd
    - .mdx
  
  # All text file extensions (for all_text mode)
  text_extensions:
    # Documentation formats
    - .md
    - .markdown
    - .txt
    - .rst
    
    # Programming languages
    - .py
    - .js
    - .ts
    - .jsx
    - .tsx
    - .java
    - .go
    - .rs
    - .php
    - .rb
    - .c
    - .cpp
    - .cs
    
    # Web technologies
    - .html
    - .css
    - .scss
    - .vue
    - .svelte
    
    # Configuration files
    - .json
    - .yaml
    - .yml
    - .toml
    - .ini
    - .env
    
    # Shell scripts
    - .sh
    - .bash
    
    # Build files
    - .dockerfile
    - .gitignore
    
    # Add more extensions as needed...
  
  # Exclude these patterns from processing
  exclude_patterns:
    - node_modules
    - .git
    - __pycache__
    - "*.pyc"
    - .DS_Store
    - dist
    - build
    - "*.min.js"
    - "*.min.css"
    - vendor
  
  # Deduplication settings
  deduplication_enabled: true
  similarity_threshold: 0.95  # 0.9-0.98 recommended
  
  # Embedding generation settings
  embedding_batch_size: 50  # Optimized for Azure OpenAI
  max_retries: 3
  batch_delay_seconds: 1  # Prevent rate limiting

# ============================================================
# PDF Processing Configuration
# ============================================================
# Note: Cloud mode and image extraction require Mistral AI to be configured
pdf_processing:
  enabled: true
  mode: local  # Options: local, cloud (requires Mistral), hybrid (requires Mistral)
  extract_images: false  # Extract images from PDFs (requires Mistral)
  image_processing_mode: none  # Options: none, ocr, description (requires Mistral Vision API)

  # Local processing settings
  local:
    primary_method: pymupdf      # Options: pymupdf, pypdfloader
    fallback_method: pypdfloader # Options: pypdfloader, none
    min_text_per_page: 50        # Minimum characters to consider valid
    preserve_layout: true         # Maintain document layout

  # Cloud processing (Mistral OCR)
  cloud:
    enabled: false
    provider: mistral_ocr
    max_pages_per_doc: 100       # Cost control: max pages per PDF
    use_for_quality: false       # Use cloud even if local succeeds

  # Hybrid mode settings
  hybrid:
    prefer_local: true           # Try local methods first
    quality_threshold: 0.7       # Text density threshold (0-1)
    force_cloud_patterns:        # File patterns to always use cloud
      - "*scan*.pdf"
      - "*scanned*.pdf"
      - "*ocr*.pdf"

# ============================================================
# Output Configuration
# ============================================================
output:
  base_directory: markdown
  combined_filename: __combined_markdown.md
  preserve_structure: true

# ============================================================
# Payload Configuration
# ============================================================
payload:
  # Content field names - list all fields that should contain the document text
  # Configure based on your integration needs:
  # - content: Required for n8n
  # - page_content: Required for LangChain
  # - document: For MCP compatibility (optional)
  # - text: Alternative field name (optional)
  content_fields:
    - content      # Primary field for n8n
    - page_content # Required for LangChain
    # - document   # Uncomment for MCP compatibility
    # - text       # Uncomment if needed

  # Preview configuration
  preview_length: 200  # Characters for preview snippet (150-300 recommended)

  # Optional: Only include specified fields (reduces payload size)
  minimal_mode: false  # If true, only includes first 2 content fields

# ============================================================
# Logging Configuration
# ============================================================
logging:
  level: INFO  # Options: DEBUG, INFO, WARNING, ERROR
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"